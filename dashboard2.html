<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Credit Karma - Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/gaugeJS/dist/gauge.min.js"></script>
  <style>
    :root {
      --primary-blue: #1e88e5;
      --light-blue: #64b5f6;
      --card-bg: #ffffff;
      --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --soft-bg: #f0f3f7;
      --text-dark: #333333;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: var(--soft-bg);
    }

    .navbar {
      background: linear-gradient(90deg, var(--light-blue), var(--primary-blue));
      color: white;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--card-shadow);
    }
    .navbar i { margin-right: 8px; }
    .logout-btn {
      background: #ffffff;
      color: var(--primary-blue);
      border: none;
      padding: 8px 16px;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .logout-btn:hover {
      background: #f1faff;
    }

    .header-info, .dashboard-wrapper, .breakdown, .history, .recommendations, .alerts {
      background: var(--card-bg);
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      margin: 20px auto;
      max-width: 900px;
      padding: 24px;
    }
    .header-info h2 {
      font-size: 28px;
      margin-bottom: 8px;
      color: var(--primary-blue);
    }
    .header-info p {
      color: #555;
      margin: 4px 0;
    }
    .credit-info-box {
      margin-top: 12px;
      background: #e3f2fd;
      padding: 14px;
      border-radius: 12px;
      font-weight: 600;
      color: var(--text-dark);
      text-align: center;
    }

    .gauges {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    .gauge-box {
      background: rgba(30, 136, 229, 0.05);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
    }
    .gauge-box canvas {
      width: 100%;
      max-width: 220px;
      height: auto;
      margin: 0 auto;
    }
    .gauge-box p {
      font-size: 16px;
      margin-top: 12px;
      color: var(--text-dark);
      font-weight: 600;
    }
    .score-frame {
      font-size: 26px;
      margin: 8px 0;
      color: var(--primary-blue);
      font-weight: 700;
    }

    .breakdown h3, .alerts h3, .history h3, .recommendations h3 {
      font-size: 20px;
      margin-bottom: 12px;
      color: var(--primary-blue);
    }
    .breakdown ul, .alerts ul, .recommendations ul {
      list-style: none;
      padding: 0;
      color: #555;
    }
    .breakdown li, .recommendations li, .alerts li {
      margin: 6px 0;
      font-size: 15px;
    }

    .history table {
      width: 100%;
      border-collapse: collapse;
      color: #555;
    }
    .history th, .history td {
      border: 1px solid #ddd;
      padding: 10px 8px;
      text-align: center;
      font-size: 15px;
    }

    .print-btn {
      background: var(--primary-blue);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 16px;
      margin-top: 20px;
      cursor: pointer;
      transition: background 0.2s;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .print-btn:hover {
      background: var(--light-blue);
    }

    .loading {
      font-size: 18px;
      color: #666;
      text-align: center;
      margin: 50px 0;
    }
  </style>
</head>
<body>
  <div class="navbar">
    <span><i class="fas fa-credit-card"></i> Credit Karma</span>
    <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
  </div>

  <div class="header-info" id="userHeader" style="display:none;">
    <h2>Welcome, <span id="userName">User</span></h2>
    <p><strong>Date of Birth:</strong> <span id="dob">--</span></p>
    <p><strong>Address:</strong> <span id="address">--</span></p>
    <p><strong>Phone:</strong> <span id="phone">--</span></p>
    <div class="credit-info-box">
      Credit Info: <span id="scoreInfo">--</span>
    </div>
  </div>

  <div class="dashboard-wrapper" id="dashboardCard" style="display:none;">
    <div class="gauges">
      <div class="gauge-box">
        <canvas id="creditGauge"></canvas>
        <div class="score-frame" id="creditValue">--</div>
        <p>Credit Score</p>
      </div>
      <div class="gauge-box">
        <canvas id="infoGauge"></canvas>
        <div class="score-frame">--</div>
        <p>Credit Info Quality</p>
      </div>
      <div class="gauge-box">
        <canvas id="transunionGauge"></canvas>
        <div class="score-frame">750</div>
        <p>TransUnion Score</p>
      </div>
      <div class="gauge-box">
        <canvas id="equifaxGauge"></canvas>
        <div class="score-frame">750</div>
        <p>Equifax Score</p>
      </div>
    </div>

    <div class="alerts">
      <h3><i class="fas fa-bell"></i> Credit Alerts</h3>
      <ul>
        <li>‚ö†Ô∏è High utilization warning: 75% on Card: *******5729</li>
        <li>‚úÖ No missed payments this month</li>
        <li>üîç 1 new credit inquiry from Bank of the People</li>
      </ul>
    </div>

    <div class="breakdown">
      <h3><i class="fas fa-chart-pie"></i> Score Breakdown</h3>
      <ul>
        <li>‚úî Payment History: Excellent</li>
        <li>‚úî Credit Utilization: 25%</li>
        <li>‚úî Credit Age: 5 years</li>
        <li>‚úî Credit Mix: Good</li>
        <li>‚úî Recent Inquiries: 1</li>
      </ul>
    </div>

    <div class="history">
      <h3><i class="fas fa-history"></i> Score History</h3>
      <table>
        <tr><th>Date</th><th>Score</th><th>Status</th></tr>
        <tr><td>2025-07-01</td><td>740</td><td>Stable</td></tr>
        <tr><td>2025-06-01</td><td>725</td><td>Improved</td></tr>
        <tr><td>2025-05-01</td><td>710</td><td>Improved</td></tr>
      </table>
    </div>

    <div class="recommendations">
      <h3><i class="fas fa-lightbulb"></i> Tips to Improve Your Score</h3>
      <ul>
        <li>üí° Pay bills on time every month</li>
        <li>üí° Keep credit utilization below 30%</li>
        <li>üí° Limit hard inquiries</li>
        <li>üí° Keep older accounts open</li>
      </ul>
    </div>

    <button class="print-btn" onclick="window.print()">
      <i class="fas fa-download"></i> Download / Print Report
    </button>
  </div>

  <div class="loading" id="loadingText">Loading dashboard...</div>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = { /* your config */ };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function logout() {
      firebase.auth().signOut().then(() => window.location = "index.html");
    }

    function createGauge(targetId, value) {
      const opts = {
        angle: 0, lineWidth: 0.3, radiusScale: 1,
        pointer: { length: 0.6, strokeWidth: 0.035, color: '#000' },
        staticLabels: { font: "12px sans-serif", labels: [0,300,500,700,900], color: "#000", fractionDigits: 0 },
        staticZones: [
          { strokeStyle: "#ff0000", min: 0, max: 300 },
          { strokeStyle: "#ff9900", min: 300, max: 500 },
          { strokeStyle: "#ffff00", min: 500, max: 700 },
          { strokeStyle: "#99cc00", min: 700, max: 800 },
          { strokeStyle: "#00cc00", min: 800, max: 900 }
        ],
        limitMax: false, limitMin: false, strokeColor: '#e0e0e0', highDpiSupport: true
      };
      const canvas = document.getElementById(targetId);
      const gauge = new Gauge(canvas).setOptions(opts);
      gauge.maxValue = 900;
      gauge.setMinValue(0);
      gauge.animationSpeed = 40;
      gauge.set(value);
    }

    function mapScoreInfoToValue(info) {
      const m = {
        "Excellent: Pays bills on time, low credit usage.": 900,
        "Trusted: Long-term borrower with strong record.": 800,
        "Good: Minor delays, healthy credit habits.": 700,
        "Fair: Occasional missed payments, moderate debt.": 600,
        "Recovering: Rebuilding after default.": 500,
        "New User: No credit history yet.": 400,
        "Monitoring: Under review due to inconsistencies.": 300,
        "Manual Review: Needs manual assessment for approval.": 200,
        "Poor: Frequent late payments, high credit utilization.": 150,
        "High Risk: Multiple delinquencies reported.": 100
      };
      return m[info] || 0;
    }

    firebase.auth().onAuthStateChanged(user => {
      if (!user) return window.location = "index.html";
      db.collection("users").doc(user.uid).get().then(doc => {
        if (!doc.exists) return document.getElementById("loadingText").innerText = "User data not found.";
        const d = doc.data();
        const score = parseInt(d.creditScore) || 0;
        const info = d.scoreInfo || '--';
        const infoScore = mapScoreInfoToValue(info);
        document.getElementById("userName").innerText = d.name || 'User';
        document.getElementById("dob").innerText = d.dob || '--';
        document.getElementById("address").innerText = d.address || '--';
        document.getElementById("phone").innerText = d.phone || '--';
        document.getElementById("scoreInfo").innerText = info;
        document.getElementById("creditValue").innerText = score;
        document.getElementById("userHeader").style.display = 'block';
        document.getElementById("dashboardCard").style.display = 'block';
        document.getElementById("loadingText").style.display = 'none';

        createGauge("creditGauge", score);
        createGauge("infoGauge", infoScore);
        createGauge("transunionGauge", 750);
        createGauge("equifaxGauge", 750);
      }).catch(err => {
        console.error(err);
        document.getElementById("loadingText").innerText = "Failed to load user data.";
      });
    });
  </script>
</body>
</html>
